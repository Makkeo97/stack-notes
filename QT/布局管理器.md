## Qt布局管理器

#### 课程目标

1. 布局管理器介绍
2. 可视化布局设计
3. QVBoxLayout垂直布局管理器
4. QHBoxLayout水平布局管理器
5. QGridLayout网格布局管理器
6. QFormLayout表单布局管理器
7. QStackedLayout堆叠布局管理器

#### 一、布局管理器介绍

> 布局管理器（Layout Manager）是在图形用户界面（GUI）应用程序中用于自动管理和排列窗口部件（Widget）的工具。

Qt 共提供了 5 种布局管理器，来帮助开发者方便地组织和管理窗口部件。每种布局管理器对应一个类，分别是 QVBoxLayout（垂直布局）、QHBoxLayout（水平布局）、QGridLayout（网格布局）、QFormLayout（表单布局）和 QStackedLayout（分组布局），继承关系如下图：

![image-20240412222614340](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240412222614.png)

#### 二、可视化布局设计

##### 1、Qt布局组件

Qt Designer 支持多种布局管理器，如垂直布局 (`QVBoxLayout`)、水平布局 (`QHBoxLayout`) 和网格布局 (`QGridLayout`)。可以通过右键点击设计区域并选择`Layouts`来应用布局管理器。

![image-20241010141206879](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20241010141206.png)

将布局管理器从工具箱拖拽到设计区域，并把控件放入到布局对应的红色框内部,，控件将被自动排列。

![image-20241010115240758](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20241010115240.png)

布局属性：

![](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20241010141412.png)

- `layoutLeftMargin`属性，用来设定布局内部所有子控件与布局左边界之间的固定间距。
- `layoutTopMargin`、`layoutRightMargin`和`layoutBottomMargin`，分别对应于顶部、右侧和底部的边距控制。
- `layoutSpacing`属性在`QVBoxLayout`中用于控制布局内相邻子控件之间的垂直间距。
- `layoutStretch`属性在`QVBoxLayout`中用于控制布局内各个子控件在分配剩余空间时的拉伸比例。

##### 2、工具栏按钮

在Qt Designer设计区域的工具栏中，也提供有布局操作按钮，提供便捷操作，如图所示。

![image-20241010144523838](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20241010144523.png)

#### 三、QVBoxLayout（垂直布局管理器）

垂直布局管理器将所有控件从上到下的顺序依次排列窗口部件。如图，将一组QLabel标签进行垂直方向布局。

![image-20240413095912615](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240413095912.png)

常用函数：

|函数|说明|
|---|---|
|addWidget(QWidget *widget, int stretch = 0, Qt::Alignment alignment = Qt::Alignment())|添加控件|
|addLayout(QLayout *layout, int stretch = 0)|添加子布局|
|setContentsMargins(int left, int top, int right, int bottom)|设置外边距|
|addSpacing(int size)|设置间距|
|setStretch(int index, int stretch)|设置拉伸系数|

实现案例代码如下：

1. `int main(int argc, char *argv[])`
2. `{`
3.     `QApplication a(argc, argv);` 
4. `//创建主窗口`
5.     `QWidget widget;`
6.     `//设置窗口标题`
7.     `widget.setWindowTitle("QVBoxLayout");`
8.     `//设置窗口大小`
9.     `widget.resize(500, 250);`

11.     `//创建垂直布局管理器`
12.     `QVBoxLayout *layout = new QVBoxLayout;`
13.     `//置布局管理器中所有控件从下往上依次排列`
14.     `layout->setDirection(QBoxLayout::BottomToTop);`

16.     `//连续创建 3 个文本框，并设置它们的背景和字体大小`
17.     `QLabel lab1("Label1");`
18.     `lab1.setStyleSheet("QLabel{background:#dddddd;font:20px;}");`
19.     `lab1.setAlignment(Qt::AlignCenter);`
20.     `QLabel lab2("Label2");`
21.     `lab2.setStyleSheet("QLabel{background:#cccccc;font:20px;}");`
22.     `lab2.setAlignment(Qt::AlignCenter);`
23.     `QLabel lab3("Label3");`
24.     `lab3.setStyleSheet("QLabel{background:#ffffff;font:20px;}");`
25.     `lab3.setAlignment(Qt::AlignCenter);`

27.     `//设置控件外边距左、上、右、下`
28.     `layout->setContentsMargins(10, 20,30, 40);`
29.     `//添加控件，控件的伸缩系数比是 1:1:1`
30.     `layout->addWidget(&lab1, 1);`
31.     `//设置控件间距（当前例子是不同label之间的间距，大小是固定的）`
32.     `layout->addSpacing(0);`
33.     `layout->addWidget(&lab2, 1);`
34.     `layout->addSpacing(0);`
35.     `layout->addWidget(&lab3, 1);`

37.     `//将布局管理器添加到widget窗口中`
38.     `widget.setLayout(layout);`
39.     `widget.show();`
40.     `a.exec();`
41. `}`

#### 四、QHBoxLayout（水平布局）

水平布局指的是将所有控件从左到右（或者从右到左）依次摆放。如图，将一组QLabel标签进行水平方向布局。

![image-20240413103451397](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240509165439.png)

1. `int main(int argc, char *argv[])`
2. `{`
3.     `QApplication a(argc, argv);`
4.     `QWidget widget;`
5.     `//设置窗口标题`
6.     `widget.setWindowTitle("QHBoxLayout");`
7.     `//设置窗口大小`
8.     `widget.resize(500, 250);`

10.     `//创建水平布局管理器`
11.     `QHBoxLayout *layout = new QHBoxLayout;`
12.     `//置布局管理器中所有控件从左往右依次排列`
13.     `layout->setDirection(QBoxLayout::LeftToRight);`

15.     `//连续创建 3 个文本框，并设置它们的背景和字体大小`
16.     `QLabel lab1("Label1");`
17.     `lab1.setStyleSheet("QLabel{background:#dddddd;font:20px;}");`
18.     `lab1.setAlignment(Qt::AlignCenter);`
19.     `QLabel lab2("Label2");`
20.     `lab2.setStyleSheet("QLabel{background:#cccccc;font:20px;}");`
21.     `lab2.setAlignment(Qt::AlignCenter);`
22.     `QLabel lab3("Label3");`
23.     `lab3.setStyleSheet("QLabel{background:#ffffff;font:20px;}");`
24.     `lab3.setAlignment(Qt::AlignCenter);`

26.     `//设置控件外边距左、上、右、下`
27.     `layout->setContentsMargins(10, 20,30, 40);`
28.     `//添加控件，控件的伸缩系数比是 1:1:1`
29.     `layout->addWidget(&lab1, 1);`
30.     `//设置控件间距（当前例子是不同label之间的间距，大小是固定的）`
31.     `layout->addSpacing(0);`
32.     `layout->addWidget(&lab2, 1);`
33.     `layout->addSpacing(0);`
34.     `layout->addWidget(&lab3, 1);`

36.     `//将布局管理器添加到widget窗口中`
37.     `widget.setLayout(layout);`
38.     `widget.show();`
39.     `a.exec();`
40. `}`

#### 五、QGridLayout（网格布局）

网格布局又称格栅布局或者表格布局，指的是将一些控件按照行和列排列在窗口上。例如：将5个QLabel标签按照行列的方式进行网格布局。

![image-20240413104741048](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240413104741.png)

常用函数：

1. `// 1、添加控件`
2. `void addWidget(QWidget *widget, int row, int column, Qt::Alignment alignment = Qt::Alignment())`
3. `void addWidget(QWidget *widget, int fromRow, int fromColumn, int rowSpan, int columnSpan,` 
4.     `Qt::Alignment alignment = Qt::Alignment())`

6. `// 2、设置拉伸系数`
7. `void setColumnStretch(int column, int stretch)    // 给指定列设置拉伸系数`
8. `void setRowStretch(int row, int stretch)    // 给指定行设置拉伸系数`

案例：

1. `int main(int argc, char *argv[])`
2. `{`
3.     `QApplication a(argc, argv);`
4.     `//创建主窗口`
5.     `QWidget widget;`
6.     `//设置窗口标题`
7.     `widget.setWindowTitle("QGridLayout");`
8.     `//设置窗口大小`
9.     `widget.resize(500, 250);`

11.     `//创建网格布局管理器`
12.     `QGridLayout *layout = new QGridLayout;`

14.     `//连续创建 5 个文本框，并设置它们的背景和字体大小`
15.     `QLabel lab1("Label1");`
16.     `lab1.setStyleSheet("QLabel{background:#dddddd;font:20px;}");`
17.     `lab1.setAlignment(Qt::AlignCenter);`
18.     `QLabel lab2("Label2");`
19.     `lab2.setStyleSheet("QLabel{background:#cccccc;font:20px;}");`
20.     `lab2.setAlignment(Qt::AlignCenter);`
21.     `QLabel lab3("Label3");`
22.     `lab3.setStyleSheet("QLabel{background:#ffffff;font:20px;}");`
23.     `lab3.setAlignment(Qt::AlignCenter);`
24.     `QLabel lab4("Label4");`
25.     `lab4.setStyleSheet("QLabel{background:#aaaaaa;font:20px;}");`
26.     `lab4.setAlignment(Qt::AlignCenter);`
27.     `QLabel lab5("Label5");`
28.     `lab5.setStyleSheet("QLabel{background:#bbbbbb;font:20px;}");`
29.     `lab5.setAlignment(Qt::AlignCenter);`

31.     `//组件添加到网格布局管理器`
32.     `layout->addWidget(&lab1, 0, 0);`
33.     `layout->addWidget(&lab2, 0, 1);`
34.     `//指定其在布局中的位置与占用格子数。`
35.     `//参数2:表示lab3将被放置在第2行（Qt布局计数从0开始）。`
36.     `//参数3: 表示lab3将被放置在第1列。`
37.     `// 参数4 和 参数5: 分别定义lab3在布局中占用的行数和列数。1, 2表示lab3将占据1行高度和2列宽度。`
38.     `layout->addWidget(&lab3, 1, 0, 1, 2);`
39.     `layout->addWidget(&lab4, 2, 0);`
40.     `layout->addWidget(&lab5, 2, 1);`

42.     `//将布局管理器添加到 widget 窗口中`
43.     `widget.setLayout(layout);`
44.     `widget.show();`
45.     `return a.exec();`
46. `}`

#### 六、QFormLayout（表单布局）

> `QFormLayout`特别适用于将一系列标签和输入控件组织成成对格式的用户界面设计，比如注册页面，每一个输入控件都有一个与之关联的标签。

![image-20240413105646051](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240413105646.png)

常用函数：

1. `// 1、添加控件`
2. `// 将指定的field控件和存储标签的label控件添加到表单控件中的末尾`
3. `void addRow(QWidget *label, QWidget *field)`    
4.  `// 将指定的 field 控件和 labelText 标签添加到表单控件的末尾`
5. `void addRow(const QString &labelText, QWidget *field)`   

7. `// 2、设置标签显示格式，默认标签位于控件的左侧`
8. `void setRowWrapPolicy(RowWrapPolicy policy)`

案例：

1. `int main(int argc, char *argv[])`
2. `{`
3.     `QApplication a(argc, argv);`
4.     `//创建主窗口`
5.     `QWidget widget;`
6.     `//设置窗口大小`
7.     `widget.resize(500, 250);`
8.     `//设置窗口标题`
9.     `widget.setWindowTitle("QFormLayout");`

11.     `//创建表单布局管理器`
12.     `QFormLayout* layout = new QFormLayout();`
13.     `//设置表单中的标签都位于控件的上方`
14.     `//layout->setRowWrapPolicy(QFormLayout::WrapAllRows);`
15.     `//添加 3 行输入框和标签`
16.     `layout->addRow("用户名:", new QLineEdit());`
17.     `layout->addRow("邮箱:", new QLineEdit());`
18.     `layout->addRow("地址:", new QLineEdit());`
19.     `//设置行间距和列间距为 20`
20.     `layout->setSpacing(20);`
21.     `//将 layout 表单添加到 widget 窗口中`
22.     `widget.setLayout(layout);`
23.     `widget.show();`
24.     `return a.exec();`
25. `}`

#### 七、QStackedLayout（分组布局管理器）

QStackedLayout布局管理器可以容纳多个控件或者窗口，但每次只显示其中的一个，如下：

![image-20240413115052603](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240413115052.png)

![image-20240413114859465](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240413114859.png)

在整个窗口布局中左侧使用QListWidget实现，添加3个子项。右侧则使用QStackedLayout存放3个子窗口，通过堆栈布局可以实现窗口间的切换。

常用函数：

1. `// 1、添加控件`
2. `int addWidget(QWidget *widget)`

4. `// 2、设置显示样式`
5. `void setStackingMode(StackingMode stackingMode)`

案例：

1. `int main(int argc, char *argv[])`
2. `{`
3.     `QApplication a(argc, argv);`
4.     `QWidget w;`
5.     `w.setWindowTitle("堆栈布局");`
6.     `w.resize(500,250);`

8.     `//创建一个列表`
9.     `QListWidget *listWidget = new QListWidget(&w);`
10.     `listWidget->setFont(QFont("宋体", 14));`
11.     `listWidget->setMinimumWidth(80);`
12.     `listWidget->addItem("窗口1");`
13.     `listWidget->addItem("窗口2");`
14.     `listWidget->addItem("窗口3");`

16.     `//新建 3 个窗口，分别放置一个标签`
17.     `QWidget widget1;`
18.     `widget1.setMinimumSize(200, 200);`
19.     `widget1.setStyleSheet("QWidget{background-color:blue}");`
20.     `QLabel label1("这里是窗口1", &widget1);`

22.     `QWidget widget2;`
23.     `widget2.setMinimumSize(200, 200);`
24.     `widget2.setStyleSheet("QWidget{background-color:red}");`
25.     `QLabel label2("这里是窗口2", &widget2);`

27.     `QWidget widget3;`
28.     `widget3.setMinimumSize(200, 200);`
29.     `widget3.setStyleSheet("QWidget{background-color:green}");`
30.     `QLabel label3("这里是窗口3", &widget3);`

32.     `//创建一个分组布局，将 3 个窗口添加到分组控件中`
33.     `QStackedLayout *stackedLayout = new QStackedLayout;`
34.     `stackedLayout->addWidget(&widget1);`
35.     `stackedLayout->addWidget(&widget2);`
36.     `stackedLayout->addWidget(&widget3);`

38.     `//向主窗口中添加一个水平布局控件`
39.     `QHBoxLayout *layout = new QHBoxLayout;`
40.     `layout->addWidget(listWidget, 1);`
41.     `layout->addLayout(stackedLayout, 4);`

43.     `//将 layout 水平布局控件添加到 widget 窗口中`
44.     `w.setLayout(layout);`
45.     `w.show();`
46.     `//连接信号和槽，实现当点击列表中的某一项，切换分组布局管理器显示的控件`
47.     `QObject::connect(listWidget, &QListWidget::currentRowChanged, stackedLayout, &QStackedLayout::setCurrentIndex);`

49.     `return a.exec();`
50. `}`