## QT常用控件

### 课程目标

1. QPushButton按钮
2. 单选按钮
3. 复选框
4. 标签控件
5. 消息框

> 在Qt中，控件、组件、部件都是一个意思，所有控件都继承自QWidget类。控件的创建有两种方式，静态创建和动态创建。静态创建是指在设计的时候把控件从工具箱中拖放到设计视图中，完成创建工作。动态创建就是程序运行的过程中通过调用函数来完成控件的创建工作。

常用界面组件包括，按钮类组件（**QPushButton**等）、输入类组件（**QLineEdit**等）、显示类组件（**QLabel**等）、容器类组件（**QWidget**等）、Item组件（**QListWidget**等）等。

这些组件通过Qt的信号和槽机制相互连接，允许组件之间的交互，从而构建功能丰富的用户界面。

### 一、按钮类控件

> 所有按钮类都继承自`QAbstractButton`类，用于触发特定操作或事件，如提交表单、打开新窗口或执行其他命令。

Qt中提供了6种Button控件，如图：

![image-20240314115351032](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240314115351.png)

|控件名称|作用|类名|
|---|---|---|
|Push Button|命令按钮，执行某些操作|QPushButton|
|Tool Button|工具按钮，通常添加在工具栏内，为命令或选项提供快速访问|QToolButton|
|Radio Button|单选按钮，选中或取消，通常一组按钮会互斥|QRadioButton|
|Check Box|复选框，除选中和取消，还有第三种可选的”无更改”状态|QCheckButton|
|Command Link Button|命令链接按钮，带有箭头图标，作用类似单选按钮|QCommandLinkButton|
|Dialog Button Box|对话框组合按钮（ok按钮和cancel按钮的组合）|QButtonBox|

### 二、QPushButton按钮

> QPushButton按钮通常用于执行命令或触发事件，比如弹出窗口、下一步、保存、退出等。大多数对话框中都有这种按钮。

#### 1、静态创建按钮

（1）创建对话框工程，并打开UI设计界面，拖动按钮如图：

![image-20240314141606307](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240314141606.png)

（2）常用的信号

- pressed： 当按钮按下时发射信号
- clicked：当单击按钮时发射信号
- released：当释放该按钮时发射信号

（3）实现槽函数

1. `#include "dialog.h"`
2. `#include "ui_dialog.h"`
3. `#include <QMessageBox>`

5. `Dialog::Dialog(QWidget *parent)`
6.     `: QDialog(parent)`
7.     `, ui(new Ui::Dialog)`
8. `{`
9.     `ui->setupUi(this);`
10. `}`

12. `Dialog::~Dialog()`
13. `{`
14.     `delete ui;`
15. `}`

17. `void Dialog::on_pushButton_pressed()`
18. `{`
19.     `QMessageBox::information(this, NULL, "按钮按下");`
20. `}`

23. `void Dialog::on_pushButton_2_released()`
24. `{`
25.     `QMessageBox::information(this, NULL, "按钮释放");`
26. `}`

29. `void Dialog::on_pushButton_3_clicked()`
30. `{`
31.     `QMessageBox::information(this, NULL, "按钮单击");`
32. `}`

#### 2、动态创建按钮

通过new QPushButton即可动态创建按钮，如果要为按钮执行其他操作，则需要通过connect()函数来关联对应的槽。

##### （1）构造函数

- `const QString icon`：参数指定了按钮上要显示的图标。
- `const QString text`按钮上要显示的文本内容。
  
- `QWidget *parent = nullptr`：参数指定按钮的父窗口部件，子对象随父对象一起被销毁，传入`nullptr`表示这个按钮没有父对象，将作为顶级部件存在。
  

1. `QPushButton(const QIcon& icon, const QString &text, QWidget *parent = nullptr);`

##### （2）常用成员函数

- setText() 设置按钮显示的文本

1. `void setText(const QString &);`

- text() 获取按钮显示的文本

1. `QString text() const;`

- setIcon(const QIcon &icon) 为按钮设置一个图标

1. `setIcon(QIcon("icon.png"));`

- setIconSize(const QSize &size)设置按钮图标的大小

1. `setIconSize(QSize(32, 32));`

- setEnabled(bool enable) 启用或禁用按钮

1. `setEnabled(false);`

- isChecked() const

对于可切换按钮（如单选按钮或复选按钮），此函数返回按钮是否被选中。普通按钮总是返回false。

- setStyleSheet(const QString &styleSheet)

通过CSS-like语法设置按钮的样式。这可以用来改变按钮的颜色、背景、边框等外观属性。例如：

1. `button->setStyleSheet("QPushButton {color: red; background-color: #ffaa00}");`

示例：

1. `// 创建一个新的 QPushButton 对象，并将其父对象设置为当前类的指针（通常是一个窗口或对话框）`
2. `QPushButton *btn = new QPushButton(this);`

4. `// 设置按钮上的文本内容为“关闭”`
5. `btn->setText("关闭");`

7. `// 为按钮设置字体，这里设置的是宋体、18点大小、粗体样式`
8. `btn->setFont(QFont("宋体", 12, QFont::Bold));`

10. `// 设置按钮的位置和大小。参数分别为：左边缘距离、上边缘距离、宽度、高度`
11. `// 在此例中，按钮将位于(150, 100)坐标处，宽80像素，高40像素`
12. `btn->setGeometry(150, 100, 80, 40);`

14. `btn->setIcon(QIcon(":/images/close.bmp"));`

16. `btn->setIconSize(QSize(132, 32));`

18. `btn->setEnabled(true);`

20. `// 使用Qt的信号与槽机制进行连接`
21. `// 当按钮被点击时，会发射一个"clicked()"信号`
22. `// 连接这个信号到当前类的一个槽函数"close()"，即当按钮被点击时，执行关闭操作`
23. `connect(btn, SIGNAL(clicked()), this, SLOT(on_but_close()));`

### 三、单选按钮

> 单选按钮（Radio button)控件带有文本标签，可以切换选中(checked)和未选中（unchecked)状态。一组按钮会互斥。

#### 1、分组

为了让单选按钮之间互斥，必须对单选按钮进行分组。放在同一个父窗体或一个按钮组。如果没有进行分组，则默认拥有相同父窗体的单选按钮都将互斥。

QButtonGroup 是一个非可视化的容器，用于管理一组 `QAbstractButton` 对象（如 QPushButton、QRadioButton 或 QCheckBox）。它的主要作用是对这些按钮进行逻辑上的分组和状态管理，而不是提供可视化的布局容器。

QButtonGroup类提供成员函数`addButton()`和`removeButton()`实现了添加按钮和删除按钮。

1. `void addButton(QAbstractButton *button, int id = -1);`

参数button是按钮对象的指针，id是给按钮设置的id号。-1表示将一个id自动赋给按钮，通过QButtonGroup类的`checkedId()`成员函数来获得id。

#### 2、信号

QRadioButton类的信号继承自QAbstractButton类，一般关注的信号是`toggled()`和`clicked()`。

- toggled()信号是在单选按钮状态（开、关）切换时触发
  
- toggled(bool)信号包含一个布尔类型的参数，用于记录按钮是否被选中。
  

#### 3、基本使用

（1）新建对话框类`RadioDialog.cpp`，打开UI设计界面，拖动2个单选按钮。对应objectName属性分别为male，female。

![image-20240314183019626](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240314183019.png)

（2）初始化QButtonGroup，添加单选按钮到按钮组，并设置ID。

1. `#include "radiodialog.h"`
2. `#include "ui_radiodialog.h"`
3. `#include <QButtonGroup>`

5. `RadioDialog::RadioDialog(QWidget *parent)`
6.     `: QDialog(parent)`
7.     `, ui(new Ui::RadioDialog)`
8. `{`
9.     `ui->setupUi(this);`
10.     `group = new QButtonGroup(this);`
11.     `group->addButton(ui->male, 0);`
12.     `group->addButton(ui->female, 1);`
13.     `ui->male->setChecked(true);//默认选中`
14. `}`

16. `RadioDialog::~RadioDialog()`
17. `{`
18.     `delete ui;`
19. `}`

（3）连接信号和槽

radiodialog.h添加槽函数声明：

1. `public slots:`
2.     `void on_radio_click();`

radiodialog.cpp添加槽函数实现：

1. `#include "radiodialog.h"`
2. `#include "ui_radiodialog.h"`
3. `#include <QButtonGroup>`
4. `#include <QMessageBox>`

6. `RadioDialog::RadioDialog(QWidget *parent)`
7.     `: QDialog(parent)`
8.     `, ui(new Ui::RadioDialog)`
9. `{`
10.     `ui->setupUi(this);`
11.     `g = new QButtonGroup(this);`
12.     `g->addButton(ui->male,0);`
13.     `g->addButton(ui->female,1);`
14.     `ui->male->setChecked(true);//男被默认选中`
15.     `connect(ui->male, &QRadioButton::toggled, this, [&](bool state){`
16.         `qDebug() << state;`
17.     `});`
18.     `connect(ui->male, &QRadioButton::clicked, this, &RadioDialog::on_radio_click);`
19.     `connect(ui->female, &QRadioButton::clicked, this, &RadioDialog::on_radio_click);`
20. `}`

22. `RadioDialog::~RadioDialog()`
23. `{`
24.     `delete ui;`
25. `}`

27. `void RadioDialog::on_radio_click()`
28. `{`
29.     `switch (g->checkedId())`
30.     `{`
31.     `case 0:`
32.         `QMessageBox::information(this, NULL, "你选择了男");`
33.         `break;`
34.     `case 1:`
35.         `QMessageBox::information(this, NULL, "你选择了女");`
36.         `break;`
37.     `}`
38. `}`

### 四、复选框

QCheckBox继承自QAbstractButton类，一组复选框可以实现多选，这种情况称为非独占方式。选中一个之后，其他自动不选中，这种情况叫独占方式，和单选按钮类似。如果实现独占效果，可以通过QButtonGroup类来实现。

#### 1、信号

`QCheckBox`类的`stateChanged`信号会在复选框的选中状态发生改变时发出。这个信号带有一个参数，其类型是`int`，表示复选框的新状态：

- **0**：表示复选框未被选中（即取消勾选状态）。
- **2**：表示复选框被选中（即有勾选标记的状态）。

#### 2、常用方法

|方法|说明|
|---|---|
|setChecked()|设置复选框的状态：true、false|
|setText()|设置复选框标题文本|
|text()|返回复选框的显示文本|
|isChecked()|检查复选框是否被选中|

#### 3、基本使用

1、新建`CheckBoxWidget`类，并打开设计师界面，拖动4个复选框

![image-20240605192207128](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240605192207.png)

2、添加槽函数

`CheckBoxWidget.h`

1. `public slots:`

3.     `// 更新全选按钮状态的槽函数`
4.     `void onCheckBoxStateChanged();`

6.     `// 全选/反选按钮的槽函数`
7.     `void on_checkBoxAll_clicked();`

`CheckBoxWidget.cpp`

1. `CheckBoxWidget::CheckBoxWidget(QWidget *parent)`
2.     `: QWidget(parent)`
3.     `, ui(new Ui::CheckBoxWidget)`
4. `{`
5.     `ui->setupUi(this);`

7.     `//列表中存储3个复选框元素`
8.     `list.push_back(ui->checkBoxB);`
9.     `list.push_back(ui->checkBoxF);`
10.     `list.push_back(ui->checkBoxP);`
11.     `//连接槽函数，实现全选按钮状态更新`
12.     `connect(ui->checkBoxAll, &QCheckBox::clicked, this, &CheckBoxWidget::on_checkBoxAll_clicked);`

14.      `//连接槽函数，实现全选反选`
15.     `foreach(QCheckBox* box, list) {`
16.         `connect(box, &QCheckBox::clicked, this, &CheckBoxWidget::onCheckBoxStateChanged);`
17.     `}`
18. `}`

20. `// 更新全选按钮状态的槽函数`
21. `void CheckBoxWidget::onCheckBoxStateChanged()`
22. `{`
23.     `//std::all_of算法检查给定范围内所有元素是否都满足某个条件`
24.     `bool allChecked = std::all_of(list.begin(), list.end(), [](QCheckBox* box){ return box->isChecked(); });`
25.     `ui->checkBoxAll->setChecked(allChecked);`
26. `}`
27. `//全选/反选按钮的槽函数`
28. `void CheckBoxWidget::on_checkBoxAll_clicked()`
29. `{`
30.     `bool isChecked = ui->checkBoxAll->isChecked();`
31.     `foreach(QCheckBox* box, list) {`
32.         `box->setChecked(isChecked);`
33.     `}`
34. `}`

### 五、标签控件

标签控件属于显示类控件，主要用于显示文本、图像等。

1. `#include "mainwindow.h"`
2. `#include "ui_mainwindow.h"`

4. `MainWindow::MainWindow(QWidget *parent)`
5.     `: QMainWindow(parent)`
6.     `, ui(new Ui::MainWindow)`
7. `{`
8.     `ui->setupUi(this);`
9.     `//显示文本`
10.     `QLabel* tlabel = ui->tlabel;`
11.     `tlabel->setText("显示文本");`
12.     `tlabel->setFont(QFont("宋体", 14));// 设置字体和大小`
13.     `tlabel->resize(150, 30);`
14.     `tlabel->setStyleSheet("QLabel{border:1px solid red }");`

16.     `QLabel* plabel = ui->plabel;`
17.     `//创建QPixmap对象，并从资源文件中加载图片`
18.     `QPixmap pixmap(":iot.jpg");`
19.     `plabel->setPixmap(pixmap);`
20.     `plabel->setAlignment(Qt::AlignCenter); // 图像居中对齐`
21.     `plabel->resize(20, 20);`
22.     `plabel->setScaledContents(true);//将pixmap图自适应填充到label`

24. `}`

26. `MainWindow::~MainWindow()`
27. `{`
28.     `delete ui;`
29. `}`

### 六、消息对话框

Qt通过QMessageBox类封装了消息对话框的各项功能，消息对话框显示了一段文本信息，以提醒用户。

QMessageBox类提供了一些静态函数可以显示消息框。

根据消息的不同目的，可以分为：

1、询问（Question）消息框

1. `// 使用QMessageBox类提供的静态函数question，创建并显示一个询问式对话框`
2. `// 参数一：指定该对话框的父窗口（this），即当前的窗口或控件`
3. `// 参数二：设置对话框的标题文本`
4. `// 参数三：设置对话框显示的主要消息内容`
5. `// 参数四：指定对话框中包含哪些按钮，这里是QMessageBox::Ok（确定）和QMessageBox::Cancel（取消）组合`
6. `QMessageBox::question(this, "标题", "询问消息框", QMessageBox::Ok|QMessageBox::Cancel);`

2、信息（Information）消息框

1. `//QMessageBox类提供的静态函数information，用于弹出一个标准的信息提示对话框`
2. `//参数一：指明消息框所属的父窗口（this），即本例中的当前Widget实例`
3. `//参数二：设定消息框的标题文本`
4. `//参数三：设定消息框内显示的主要信息内容`
5. `QMessageBox::information(this, "标题", "信息消息框");`

3、警告（Warning）消息框

1.  `QMessageBox::warning(this, "标题", "警告消息框");`

4、紧急（Critical）消息框

1. `QMessageBox::critical(this,"标题","紧急消息框",QMessageBox::Ok);`

5、自定义（Custom）消息框

1.   `QMessageBox box(QMessageBox::NoIcon, "标题","自定义消息框", QMessageBox::Retry | QMessageBox::Abort  | QMessageBox::Ignore);`
2.     `box.setIconPixmap(QPixmap(":/images/close.bmp"));`
3.     `box.exec();`