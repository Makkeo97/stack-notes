## Qt菜单栏、工具栏和状态栏

菜单栏、工具栏和状态栏一般用在MainWindow项目中，菜单栏、工具栏位于窗口上放，状态栏位于窗口下方。

### 一、菜单栏

> 菜单栏位于窗口顶部，菜单栏中的每个菜单项可以展开显示更多的子菜单或直接执行某个动作。

![image-20240903171839939](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240903171847.png)

QMenuBar是菜单栏类，菜单栏上可以有多个菜单项，用户单击菜单项后，会触发一个动作。因此在Qt中使用菜单栏涉及到3个类：QMenuBar菜单栏类、QMenu菜单类和QAction动作类。

#### 1、创建菜单栏

创建一个菜单栏，需要5个基本步骤:

##### （1）创建菜单栏对象

获取MainWindow窗口的菜单栏对象：

1.  `QMenuBar *bar = this->menuBar();//this是MainWindow实例`

##### （2）添加菜单

为菜单栏添加一个或多个菜单项，每个菜单项都是一个`QMenu`对象。

1. `QMenuBar *bar = this->menuBar();`
2. `QMenu *fileMenu = bar->addMenu("文件(&F)"); //"&"表示快捷键，这里是Alt+F`

或者

1. `QMenu *fileMenu = new QMenu("文件(&F)");`
2. `bar->addMenu(fileMenu);`

##### （3）添加动作

`QAction`是一个表示动作的抽象类。可以关联到一个槽函数，当动作被触发时执行特定的代码逻辑。

1. `QAction *open = fileMenu->addAction("打开文件");`
2. `QIcon icon(":/images/open_icon.png"); // ":/images/open_icon.png"是资源文件中的图标路径`
3. `open->setIcon(icon); //给QAction添加图标`
4. `open->setShortcut(QKeySequence::Open); //给QAction设置快捷键`

6. `QAction *close = fileMenu->addAction("关闭");`

##### （4）连接槽函数

`&QAction::triggered` 是 `QAction` 类的一个信号，当用户触发这个动作时（点击菜单项），这个信号会被发射。

1. `connect(close, &QAction::triggered, this, &MainWindow::on_close_trigged);`

##### （5）实现槽函数

1. `void MainWindow::on_close_trigged()`
2. `{`
3.     `this->close();`
4. `}`

完整代码示例：

1. `MainWindow::MainWindow(QWidget *parent)`
2.     `: QMainWindow(parent)`
3.     `, ui(new Ui::MainWindow)`
4. `{`
5.     `ui->setupUi(this);`
6.     `QMenuBar *menuBar = this->menuBar();`
7.     `QMenu *file = menuBar->addMenu("文件(&F)");`
8.     `QMenu *edit = menuBar->addMenu("编辑(&E)");`
9.     `QMenu *view = menuBar->addMenu("视图(&V)");`
10.     `QMenu *build = menuBar->addMenu("构建(&B)");`

12.     `QAction *open = file->addAction("打开文件");`
13.     `open->setIcon(QIcon(":/images/open.bmp"));`
14.     `open->setShortcut(QKeySequence::Open);`

16.     `QAction *close = file->addAction("关闭");`
17.     `close->setIcon((QIcon(":/images/close.bmp")));`
18.     `close->setShortcut(QKeySequence::Close);`

21.     `QMenu *menu = edit->addMenu("查找/替换(&R)");`
22.     `QAction *find = menu->addAction("查找");`
23.     `find->setIcon(QIcon(":/images/find.bmp"));`
24.     `find->setShortcut(QKeySequence::Find);`

26.     `QAction *replace = menu->addAction("替换");`
27.     `replace->setIcon(QIcon(":/images/replace.bmp"));`
28.     `replace->setShortcut(QKeySequence::Replace);`

30.     `connect(close, &QAction::triggered, [this]()`
31.             `{`
32.         `this->close();`
33.     `});`
34. `}`

#### 3、可视化的方式创建菜单

##### （1）新建项目

双击mainwindow.ui，在出现的窗口设计界面中会发现顶部有两行，第一行是菜单栏。

双击`在这里输入`，输入菜单名，然后回车。同时会出现下拉菜单，定位到下拉菜单上并双击，可以继续输入子菜单项名。

![image-20240516165702715](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240516165702.png)

##### （2）添加槽函数

选择action，右键转到槽。

![image-20240516165753393](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240516165753.png)

### 二、工具栏

> 工具栏通常位于菜单栏的下方，工具栏（`QToolBar`）是一个用于集中放置操作按钮和工具的区域，为用户提供了一种快速访问常用功能的方式。

![image-20240904101743740](https://woniumd.oss-cn-hangzhou.aliyuncs.com/aiot/hanling/20240904101743.png)

#### 1、创建工具栏

（1）启动Qt Creator，新建MainWindow项目，创建QToolBar工具栏对象

1. `QToolBar *toolbar = new QToolBar;`
2. `this->addToolBar(toolbar); //this是QMainWindow对象实例`

#### 2、添加动作

向工具栏添加`QAction`：

1. `QAction* create = new QAction(QIcon(":images/open.bmp"), "新建文件(&N)", this);`
2. `create->setShortcut(QKeySequence::New); // 设置快捷键`
3. `toolBar->addAction(create);`
4. `connect(create, &QAction::triggered, this, [=](){`
5.        `edit->clear();`
6. `});`

**示例：**

头文件

1. `#ifndef MAINWINDOW_H`
2. `#define MAINWINDOW_H`
3. `#include <QAction>`
4. `#include <QMainWindow>`
5. `#include <QPlainTextEdit>`

7. `QT_BEGIN_NAMESPACE`
8. `namespace Ui {`
9. `class MainWindow;`
10. `}`
11. `QT_END_NAMESPACE`

13. `class MainWindow : public QMainWindow`
14. `{`
15.     `Q_OBJECT`

17. `public:`
18.     `MainWindow(QWidget *parent = nullptr);`
19.     `~MainWindow();`
20. `public slots:`
21.     `void on_action_bold_triggered(bool);`
22.     `void on_action_itlalics_triggered(bool);`
23.     `void on_action_underline_triggered(bool);`

25. `private:`
26.     `Ui::MainWindow *ui;`
27.     `QPlainTextEdit *edit;`
28.     `QAction *create;`
29.     `QAction *bold;`
30.     `QAction *underLine;`
31.     `QAction *italics;`
32. `};`
33. `#endif // MAINWINDOW_H`

（3）创建工具栏

1. `#include "mainwindow.h"`
2. `#include "ui_mainwindow.h"`
3. `#include <QToolBar>`
4. `#include <QDebug>`
5. `#include <QPlainTextEdit>`
6. `#include <QWidget>`
7. `#include <QVBoxLayout>`
8. `MainWindow::MainWindow(QWidget *parent)`
9.     `: QMainWindow(parent)`
10.     `, ui(new Ui::MainWindow)`
11. `{`
12.     `ui->setupUi(this);`

14.     `QToolBar* toolBar = this->addToolBar("toolbar");`
15.     `create = new QAction(QIcon(":images/open.bmp"), "新建文件", this);`
16.     `bold = new QAction(QIcon(":images/b.bmp"), "加粗", this);`
17.     `bold->setCheckable(true); //动作设置为可切换`

19.     `italics = new QAction(QIcon(":images/i.bmp"), "斜体", this);`
20.     `italics->setCheckable(true); //动作设置为可切换`

22.     `underLine = new QAction(QIcon(":images/u.bmp"), "下划线", this);`
23.     `underLine->setCheckable(true); //动作设置为可切换`

25.     `toolBar->addAction(create);`
26.     `toolBar->addAction(bold);`
27.     `toolBar->addAction(italics);`
28.     `toolBar->addAction(underLine);`

30.     `// 当前窗口的中心部件`
31.     `QWidget *center = this->centralWidget();`
32.     `// 在center中创建一个新的垂直布局（QVBoxLayout）并将其设为中心部件的布局管理器`
33.     `QVBoxLayout *layout = new QVBoxLayout(center);`

35.     `// 创建一个新的QPlainTextEdit（多行纯文本编辑器）对象，并将中心部件（center）设为其父窗口`
36.     `edit = new QPlainTextEdit(center);`

38.     `// 将QPlainTextEdit对象添加到垂直布局中，使其成为布局的一部分`
39.     `layout->addWidget(edit);`

41.     `connect(create, &QAction::triggered, this, [=](){`
42.        `edit->clear();`
43.     `});`

45.     `connect(bold, &QAction::triggered, this, &MainWindow::on_action_bold_triggered);`
46.     `connect(italics, &QAction::triggered, this, &MainWindow::on_action_itlalics_triggered);`
47.     `connect(underLine, &QAction::triggered, this, &MainWindow::on_action_underline_triggered);`
48. `}`

（4）槽函数实现

1. `void MainWindow::on_action_bold_triggered(bool checked)`
2. `{`
3.     `// 获取当前文本编辑框（edit）中选定文本的字符格式`
4.     `QTextCharFormat fmt=edit->currentCharFormat();`
5.     `// 根据触发时加粗动作的勾选状态（checked）来修改字体的粗体属性`
6.     `if(checked)`
7.         `fmt.setFontWeight(QFont::Bold);//设置字体权重为粗体`
8.     `else`
9.         `fmt.setFontWeight(QFont::Normal);`
10.     `// 将修改后的字符格式应用到当前选定的文本，实现加粗或取消加粗的效果`
11.     `edit->mergeCurrentCharFormat(fmt);`
12. `}`

14. `void MainWindow::on_action_itlalics_triggered(bool checked)`
15. `{`
16.      `// 获取当前文本编辑框（edit）中选定文本的字符格式`
17.     `QTextCharFormat fmt=edit->currentCharFormat();`
18.      `//修改字体的斜体属性`
19.     `fmt.setFontItalic(checked);`
20.     `edit->mergeCurrentCharFormat(fmt);`
21. `}`

23. `void MainWindow::on_action_underline_triggered(bool checked)`
24. `{`
25.     `QTextCharFormat fmt=edit->currentCharFormat();`
26.     `//修改字体的下划线属性`
27.     `fmt.setFontUnderline(checked);`
28.     `edit->mergeCurrentCharFormat(fmt);`
29. `}`

#### 3、可视化方式添加工具栏

（1）启动Qt Creator，新建项目

（2）创建资源文件

（3）以可视化的方式新建工具栏按钮

- 新建Action
- 为Action设置图标
- 将Action拖放到工具栏

（4）添加槽函数

右击`名称`下的action，在弹出的菜单中选择`转到槽`。添加信号槽函数。

（5）运行

#### 4、QToolButton

> `QToolButton`是一个可视化的按钮控件，通常用于工具栏中，作为快捷按钮使用。和普通按钮不同，通常不显示文本，而显示图标。

使用 `QToolButton` 的基本步骤：

##### （1）创建 `QToolButton` 实例

创建一个 `QToolButton` 实例。可以在主窗口或任何适当的容器中完成。

1. `QToolButton *toolButton = new QToolButton(this);`

##### （2）设置图标和文本

可以为 `QToolButton` 设置图标和/或文本。图标通常用于提供视觉提示，而文本则提供额外的描述信息。

1. `toolButton->setIcon(QIcon(":/icons/myicon.png")); // 设置图标`
2. `toolButton->setText("My Tool Button");             // 设置文本`

##### （3）设置按钮风格

该函数用于设置按钮的风格，比如只显示图标，只显示文本，或者文本位于图标旁边、下方等。

1. `toolButton->setToolButtonStyle(Qt::ToolButtonTextUnderIcon); // 设置文本显示在图标下方`

参数style是要设置的风格，默认值是，Qt::ToolButtonIconOnly。Qt::ToolButtonStyle是枚举类型，取值如下：

|常量|值|说明|
|---|---|---|
|Qt::ToolButtonIconOnly|0|只显示图标|
|Qt::ToolButtonTextOnly|1|只显示文本|
|Qt::ToolButtonTextBesideIcon|2|文本显示在图标旁边|
|Qt::ToolButtonTextUnderIcon|3|文本显示在图标下边|

##### （4）设置工具提示

为按钮添加工具提示（当用户将鼠标悬停在按钮上时显示的小文本框）

1. `toolButton->setToolTip("This is a tool button"); // 设置工具提示`

##### （5）设置按钮尺寸和样式

可以设置按钮的最小尺寸或启用/禁用文本显示

1. `toolButton->setMinimumSize(QSize(32, 32)); // 设置最小尺寸`

##### （6）连接信号和槽

为了响应用户的交互，需要将 `QToolButton` 的信号（如 `clicked()`）连接到适当的槽函数。

1. `connect(toolButton, &QToolButton::clicked, this, &MainWindow::onToolButtonClicked);`

##### （7）将 `QToolButton` 添加到工具栏

使用 `QToolBar` 的 `addWidget()` 方法，添加到工具栏中。

1. `toolBar->addWidget(toolButton);               // 将QToolButton添加到工具栏中`

### 三、状态栏

> `QStatusBar` 是一个状态栏组件，位于窗口的底部，可以用来显示临时消息、操作提示、进度条等状态信息。

1、创建状态栏

1.  `QStatusBar* statusBar = ui->statusbar;`

2、显示文本消息

1. `statusBar()->showMessage("消息文本");`

3、添加部件

1. `QLabel *label = new QLabel("消息文本", this);`
2. `statusBar->addWidget(label);`